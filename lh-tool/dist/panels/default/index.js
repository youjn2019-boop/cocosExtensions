"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const vue_1 = require("vue");
module.exports = Editor.Panel.define({
    listeners: {
        show() {
            console.log('show');
        },
        hide() {
            console.log('hide');
        },
    },
    template: (0, fs_extra_1.readFileSync)((0, path_1.join)(__dirname, '../../../static/template/default/index.html'), 'utf-8'),
    style: (0, fs_extra_1.readFileSync)((0, path_1.join)(__dirname, '../../../static/style/default/index.css'), 'utf-8'),
    $: {
        app: '#app',
    },
    methods: {},
    ready() {
        const self = this;
        const extensionRoot = (0, path_1.resolve)(__dirname, '../../../');
        const configPath = (0, path_1.join)(extensionRoot, 'tool/config/config.json');
        // 创建 Vue 应用
        const app = (0, vue_1.createApp)({
            data() {
                return {
                    activeTab: 'table',
                    config: {
                        exeFile: '',
                        dataDir: '',
                        codeDir: '',
                        exportDataDir: '',
                        langDir: '',
                        tempDir: '',
                        exportMode: 'all',
                        formatEnabled: false,
                    }
                };
            },
            mounted() {
                this.loadConfig();
            },
            methods: {
                // ========== 配置管理 ==========
                loadConfig() {
                    try {
                        if ((0, fs_extra_1.existsSync)(configPath)) {
                            const loadedConfig = JSON.parse((0, fs_extra_1.readFileSync)(configPath, 'utf-8'));
                            Object.assign(this.config, loadedConfig);
                            console.log('配置已加载');
                        }
                        else {
                            // 配置文件不存在，创建默认配置
                            console.log('配置文件不存在，创建默认配置');
                            this.saveConfig();
                        }
                    }
                    catch (error) {
                        console.error('加载配置失败:', error);
                    }
                },
                saveConfig() {
                    try {
                        const fs = require('fs-extra');
                        fs.ensureDirSync((0, path_1.join)(extensionRoot, 'tool/config'));
                        (0, fs_extra_1.writeFileSync)(configPath, JSON.stringify(this.config, null, 2), 'utf-8');
                        console.log('配置已保存到:', configPath);
                    }
                    catch (error) {
                        console.error('保存配置失败:', error);
                    }
                },
                // ========== 文件/目录选择 ==========
                async selectFile(field, title, filters) {
                    const result = await Editor.Dialog.select({ title, type: 'file', filters });
                    if (result.filePaths && result.filePaths.length > 0) {
                        this.config[field] = result.filePaths[0];
                        this.saveConfig();
                    }
                },
                async selectDirectory(field, title) {
                    const result = await Editor.Dialog.select({ title, type: 'directory' });
                    if (result.filePaths && result.filePaths.length > 0) {
                        this.config[field] = result.filePaths[0];
                        this.saveConfig();
                    }
                },
                // ========== 操作按钮 ==========
                async exportLocalize() {
                    try {
                        const { exportLocalize } = require((0, path_1.join)(extensionRoot, 'dist/table/export-localize'));
                        const config = this.config;
                        const exportConfig = {
                            dataDir: config.dataDir,
                            langDir: config.langDir,
                            formatEnabled: config.formatEnabled,
                        };
                        console.log('开始导出多语言...', exportConfig);
                        const result = exportLocalize(exportConfig);
                        if (result.success) {
                            console.log('✅ 导出成功!', result.message);
                            if (result.files) {
                                result.files.forEach((f) => console.log('  -', f));
                            }
                            await Editor.Dialog.info('导出成功', {
                                detail: result.message,
                                buttons: ['确定']
                            });
                        }
                        else {
                            console.error('❌ 导出失败:', result.message);
                            await Editor.Dialog.error('导出失败', {
                                detail: result.message,
                                buttons: ['确定']
                            });
                        }
                    }
                    catch (error) {
                        console.error('导出多语言异常:', error);
                        await Editor.Dialog.error('导出异常', {
                            detail: error.message || '未知错误',
                            buttons: ['确定']
                        });
                    }
                },
                handleTableCopy() {
                    console.log('打表+复制');
                    // TODO: 实现打表+复制功能
                },
                handleTableCopyGen() {
                    console.log('打表+复制+生成tableMgr');
                    // TODO: 实现打表+复制+生成tableMgr功能
                },
            }
        });
        // 挂载 Vue 应用
        app.mount(self.$.app);
    },
    beforeClose() { },
    close() { },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zb3VyY2UvcGFuZWxzL2RlZmF1bHQvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx1Q0FBbUU7QUFDbkUsK0JBQXFDO0FBQ3JDLDZCQUFnQztBQUVoQyxNQUFNLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO0lBQ2pDLFNBQVMsRUFBRTtRQUNQLElBQUk7WUFDQSxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hCLENBQUM7UUFDRCxJQUFJO1lBQ0EsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4QixDQUFDO0tBQ0o7SUFDRCxRQUFRLEVBQUUsSUFBQSx1QkFBWSxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSw2Q0FBNkMsQ0FBQyxFQUFFLE9BQU8sQ0FBQztJQUMvRixLQUFLLEVBQUUsSUFBQSx1QkFBWSxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSx5Q0FBeUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQztJQUN4RixDQUFDLEVBQUU7UUFDQyxHQUFHLEVBQUUsTUFBTTtLQUNkO0lBQ0QsT0FBTyxFQUFFLEVBQUU7SUFDWCxLQUFLO1FBQ0QsTUFBTSxJQUFJLEdBQUcsSUFBVyxDQUFDO1FBQ3pCLE1BQU0sYUFBYSxHQUFHLElBQUEsY0FBTyxFQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUN0RCxNQUFNLFVBQVUsR0FBRyxJQUFBLFdBQUksRUFBQyxhQUFhLEVBQUUseUJBQXlCLENBQUMsQ0FBQztRQUVsRSxZQUFZO1FBQ1osTUFBTSxHQUFHLEdBQUcsSUFBQSxlQUFTLEVBQUM7WUFDbEIsSUFBSTtnQkFDQSxPQUFPO29CQUNILFNBQVMsRUFBRSxPQUFPO29CQUNsQixNQUFNLEVBQUU7d0JBQ0osT0FBTyxFQUFFLEVBQUU7d0JBQ1gsT0FBTyxFQUFFLEVBQUU7d0JBQ1gsT0FBTyxFQUFFLEVBQUU7d0JBQ1gsYUFBYSxFQUFFLEVBQUU7d0JBQ2pCLE9BQU8sRUFBRSxFQUFFO3dCQUNYLE9BQU8sRUFBRSxFQUFFO3dCQUNYLFVBQVUsRUFBRSxLQUFLO3dCQUNqQixhQUFhLEVBQUUsS0FBSztxQkFDdkI7aUJBQ0osQ0FBQztZQUNOLENBQUM7WUFFRCxPQUFPO2dCQUNILElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUN0QixDQUFDO1lBRUQsT0FBTyxFQUFFO2dCQUNMLDZCQUE2QjtnQkFDN0IsVUFBVTtvQkFDTixJQUFJLENBQUM7d0JBQ0QsSUFBSSxJQUFBLHFCQUFVLEVBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQzs0QkFDekIsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFBLHVCQUFZLEVBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7NEJBQ25FLE1BQU0sQ0FBQyxNQUFNLENBQUUsSUFBWSxDQUFDLE1BQU0sRUFBRSxZQUFZLENBQUMsQ0FBQzs0QkFDbEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFDekIsQ0FBQzs2QkFBTSxDQUFDOzRCQUNKLGlCQUFpQjs0QkFDakIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDOzRCQUM3QixJQUFZLENBQUMsVUFBVSxFQUFFLENBQUM7d0JBQy9CLENBQUM7b0JBQ0wsQ0FBQztvQkFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO3dCQUNiLE9BQU8sQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDO29CQUNwQyxDQUFDO2dCQUNMLENBQUM7Z0JBRUQsVUFBVTtvQkFDTixJQUFJLENBQUM7d0JBQ0QsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO3dCQUMvQixFQUFFLENBQUMsYUFBYSxDQUFDLElBQUEsV0FBSSxFQUFDLGFBQWEsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDO3dCQUNyRCxJQUFBLHdCQUFhLEVBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUUsSUFBWSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7d0JBQ2xGLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDO29CQUN2QyxDQUFDO29CQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7d0JBQ2IsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7b0JBQ3BDLENBQUM7Z0JBQ0wsQ0FBQztnQkFFRCxnQ0FBZ0M7Z0JBQ2hDLEtBQUssQ0FBQyxVQUFVLENBQUMsS0FBYSxFQUFFLEtBQWEsRUFBRSxPQUFlO29CQUMxRCxNQUFNLE1BQU0sR0FBRyxNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztvQkFDNUUsSUFBSSxNQUFNLENBQUMsU0FBUyxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO3dCQUNoRCxJQUFZLENBQUMsTUFBYyxDQUFDLEtBQUssQ0FBQyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQzFELElBQVksQ0FBQyxVQUFVLEVBQUUsQ0FBQztvQkFDL0IsQ0FBQztnQkFDTCxDQUFDO2dCQUVELEtBQUssQ0FBQyxlQUFlLENBQUMsS0FBYSxFQUFFLEtBQWE7b0JBQzlDLE1BQU0sTUFBTSxHQUFHLE1BQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUM7b0JBQ3hFLElBQUksTUFBTSxDQUFDLFNBQVMsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQzt3QkFDaEQsSUFBWSxDQUFDLE1BQWMsQ0FBQyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUMxRCxJQUFZLENBQUMsVUFBVSxFQUFFLENBQUM7b0JBQy9CLENBQUM7Z0JBQ0wsQ0FBQztnQkFFRCw2QkFBNkI7Z0JBQzdCLEtBQUssQ0FBQyxjQUFjO29CQUNoQixJQUFJLENBQUM7d0JBQ0QsTUFBTSxFQUFFLGNBQWMsRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFBLFdBQUksRUFBQyxhQUFhLEVBQUUsNEJBQTRCLENBQUMsQ0FBQyxDQUFDO3dCQUV0RixNQUFNLE1BQU0sR0FBSSxJQUFZLENBQUMsTUFBTSxDQUFDO3dCQUNwQyxNQUFNLFlBQVksR0FBRzs0QkFDakIsT0FBTyxFQUFFLE1BQU0sQ0FBQyxPQUFPOzRCQUN2QixPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU87NEJBQ3ZCLGFBQWEsRUFBRSxNQUFNLENBQUMsYUFBYTt5QkFDdEMsQ0FBQzt3QkFFRixPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQzt3QkFDeEMsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO3dCQUU1QyxJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQzs0QkFDakIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDOzRCQUN2QyxJQUFJLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQ0FDZixNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQVMsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQzs0QkFDL0QsQ0FBQzs0QkFDRCxNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtnQ0FDN0IsTUFBTSxFQUFFLE1BQU0sQ0FBQyxPQUFPO2dDQUN0QixPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUM7NkJBQ2xCLENBQUMsQ0FBQzt3QkFDUCxDQUFDOzZCQUFNLENBQUM7NEJBQ0osT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDOzRCQUN6QyxNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtnQ0FDOUIsTUFBTSxFQUFFLE1BQU0sQ0FBQyxPQUFPO2dDQUN0QixPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUM7NkJBQ2xCLENBQUMsQ0FBQzt3QkFDUCxDQUFDO29CQUNMLENBQUM7b0JBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQzt3QkFDbEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7d0JBQ2pDLE1BQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFOzRCQUM5QixNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sSUFBSSxNQUFNOzRCQUMvQixPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUM7eUJBQ2xCLENBQUMsQ0FBQztvQkFDUCxDQUFDO2dCQUNMLENBQUM7Z0JBRUQsZUFBZTtvQkFDWCxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUNyQixrQkFBa0I7Z0JBQ3RCLENBQUM7Z0JBRUQsa0JBQWtCO29CQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQztvQkFDaEMsNkJBQTZCO2dCQUNqQyxDQUFDO2FBQ0o7U0FDSixDQUFDLENBQUM7UUFFSCxZQUFZO1FBQ1osR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFDRCxXQUFXLEtBQUksQ0FBQztJQUNoQixLQUFLLEtBQUksQ0FBQztDQUNiLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJlYWRGaWxlU3luYywgd3JpdGVGaWxlU3luYywgZXhpc3RzU3luYyB9IGZyb20gJ2ZzLWV4dHJhJztcclxuaW1wb3J0IHsgam9pbiwgcmVzb2x2ZSB9IGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgeyBjcmVhdGVBcHAgfSBmcm9tICd2dWUnO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBFZGl0b3IuUGFuZWwuZGVmaW5lKHtcclxuICAgIGxpc3RlbmVyczoge1xyXG4gICAgICAgIHNob3coKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzaG93Jyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBoaWRlKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaGlkZScpO1xyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgdGVtcGxhdGU6IHJlYWRGaWxlU3luYyhqb2luKF9fZGlybmFtZSwgJy4uLy4uLy4uL3N0YXRpYy90ZW1wbGF0ZS9kZWZhdWx0L2luZGV4Lmh0bWwnKSwgJ3V0Zi04JyksXHJcbiAgICBzdHlsZTogcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vc3RhdGljL3N0eWxlL2RlZmF1bHQvaW5kZXguY3NzJyksICd1dGYtOCcpLFxyXG4gICAgJDoge1xyXG4gICAgICAgIGFwcDogJyNhcHAnLFxyXG4gICAgfSxcclxuICAgIG1ldGhvZHM6IHt9LFxyXG4gICAgcmVhZHkoKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXMgYXMgYW55O1xyXG4gICAgICAgIGNvbnN0IGV4dGVuc2lvblJvb3QgPSByZXNvbHZlKF9fZGlybmFtZSwgJy4uLy4uLy4uLycpO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZ1BhdGggPSBqb2luKGV4dGVuc2lvblJvb3QsICd0b29sL2NvbmZpZy9jb25maWcuanNvbicpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIOWIm+W7uiBWdWUg5bqU55SoXHJcbiAgICAgICAgY29uc3QgYXBwID0gY3JlYXRlQXBwKHtcclxuICAgICAgICAgICAgZGF0YSgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlVGFiOiAndGFibGUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleGVGaWxlOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YURpcjogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVEaXI6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvcnREYXRhRGlyOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ0RpcjogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBEaXI6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRNb2RlOiAnYWxsJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0RW5hYmxlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1vdW50ZWQoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRDb25maWcoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1ldGhvZHM6IHtcclxuICAgICAgICAgICAgICAgIC8vID09PT09PT09PT0g6YWN572u566h55CGID09PT09PT09PT1cclxuICAgICAgICAgICAgICAgIGxvYWRDb25maWcoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0c1N5bmMoY29uZmlnUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvYWRlZENvbmZpZyA9IEpTT04ucGFyc2UocmVhZEZpbGVTeW5jKGNvbmZpZ1BhdGgsICd1dGYtOCcpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oKHRoaXMgYXMgYW55KS5jb25maWcsIGxvYWRlZENvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6YWN572u5bey5Yqg6L29Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDphY3nva7mlofku7bkuI3lrZjlnKjvvIzliJvlu7rpu5jorqTphY3nva5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfphY3nva7mlofku7bkuI3lrZjlnKjvvIzliJvlu7rpu5jorqTphY3nva4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzIGFzIGFueSkuc2F2ZUNvbmZpZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign5Yqg6L296YWN572u5aSx6LSlOicsIGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBzYXZlQ29uZmlnKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMtZXh0cmEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnMuZW5zdXJlRGlyU3luYyhqb2luKGV4dGVuc2lvblJvb3QsICd0b29sL2NvbmZpZycpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVGaWxlU3luYyhjb25maWdQYXRoLCBKU09OLnN0cmluZ2lmeSgodGhpcyBhcyBhbnkpLmNvbmZpZywgbnVsbCwgMiksICd1dGYtOCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6YWN572u5bey5L+d5a2Y5YiwOicsIGNvbmZpZ1BhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+S/neWtmOmFjee9ruWksei0pTonLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gPT09PT09PT09PSDmlofku7Yv55uu5b2V6YCJ5oupID09PT09PT09PT1cclxuICAgICAgICAgICAgICAgIGFzeW5jIHNlbGVjdEZpbGUoZmllbGQ6IHN0cmluZywgdGl0bGU6IHN0cmluZywgZmlsdGVycz86IGFueVtdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRWRpdG9yLkRpYWxvZy5zZWxlY3QoeyB0aXRsZSwgdHlwZTogJ2ZpbGUnLCBmaWx0ZXJzIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZmlsZVBhdGhzICYmIHJlc3VsdC5maWxlUGF0aHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoKHRoaXMgYXMgYW55KS5jb25maWcgYXMgYW55KVtmaWVsZF0gPSByZXN1bHQuZmlsZVBhdGhzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAodGhpcyBhcyBhbnkpLnNhdmVDb25maWcoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBhc3luYyBzZWxlY3REaXJlY3RvcnkoZmllbGQ6IHN0cmluZywgdGl0bGU6IHN0cmluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEVkaXRvci5EaWFsb2cuc2VsZWN0KHsgdGl0bGUsIHR5cGU6ICdkaXJlY3RvcnknIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZmlsZVBhdGhzICYmIHJlc3VsdC5maWxlUGF0aHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoKHRoaXMgYXMgYW55KS5jb25maWcgYXMgYW55KVtmaWVsZF0gPSByZXN1bHQuZmlsZVBhdGhzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAodGhpcyBhcyBhbnkpLnNhdmVDb25maWcoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyA9PT09PT09PT09IOaTjeS9nOaMiemSriA9PT09PT09PT09XHJcbiAgICAgICAgICAgICAgICBhc3luYyBleHBvcnRMb2NhbGl6ZSgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGV4cG9ydExvY2FsaXplIH0gPSByZXF1aXJlKGpvaW4oZXh0ZW5zaW9uUm9vdCwgJ2Rpc3QvdGFibGUvZXhwb3J0LWxvY2FsaXplJykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uZmlnID0gKHRoaXMgYXMgYW55KS5jb25maWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cG9ydENvbmZpZyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFEaXI6IGNvbmZpZy5kYXRhRGlyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ0RpcjogY29uZmlnLmxhbmdEaXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRFbmFibGVkOiBjb25maWcuZm9ybWF0RW5hYmxlZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCflvIDlp4vlr7zlh7rlpJror63oqIAuLi4nLCBleHBvcnRDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBleHBvcnRMb2NhbGl6ZShleHBvcnRDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIOWvvOWHuuaIkOWKnyEnLCByZXN1bHQubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmZpbGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmZpbGVzLmZvckVhY2goKGY6IHN0cmluZykgPT4gY29uc29sZS5sb2coJyAgLScsIGYpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IEVkaXRvci5EaWFsb2cuaW5mbygn5a+85Ye65oiQ5YqfJywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbDogcmVzdWx0Lm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uczogWyfnoa7lrponXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwg5a+85Ye65aSx6LSlOicsIHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IEVkaXRvci5EaWFsb2cuZXJyb3IoJ+WvvOWHuuWksei0pScsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWw6IHJlc3VsdC5tZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbnM6IFsn56Gu5a6aJ11cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCflr7zlh7rlpJror63oqIDlvILluLg6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBFZGl0b3IuRGlhbG9nLmVycm9yKCflr7zlh7rlvILluLgnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWw6IGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b25zOiBbJ+ehruWumiddXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGhhbmRsZVRhYmxlQ29weSgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5omT6KGoK+WkjeWIticpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IOWunueOsOaJk+ihqCvlpI3liLblip/og71cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGhhbmRsZVRhYmxlQ29weUdlbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5omT6KGoK+WkjeWItivnlJ/miJB0YWJsZU1ncicpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IOWunueOsOaJk+ihqCvlpI3liLYr55Sf5oiQdGFibGVNZ3Llip/og71cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyDmjILovb0gVnVlIOW6lOeUqFxyXG4gICAgICAgIGFwcC5tb3VudChzZWxmLiQuYXBwKTtcclxuICAgIH0sXHJcbiAgICBiZWZvcmVDbG9zZSgpIHt9LFxyXG4gICAgY2xvc2UoKSB7fSxcclxufSk7XHJcbiJdfQ==